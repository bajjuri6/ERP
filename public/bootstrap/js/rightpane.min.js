$(document).ready(function(){function t(e,t){var n={auth:"",dt:"",mth:"",tm:"",lc:"",id:"",url:"",tag:"",tl:"",ctgy:"",tmsp:""};var r=new Array;r[0]="Jan";r[1]="Feb";r[2]="Mar";r[3]="Apr";r[4]="May";r[5]="Jun";r[6]="Jul";r[7]="Aug";r[8]="Sep";r[9]="Oct";r[10]="Nov";r[11]="Dec";if(t=="stream"){var i=$.parseJSON(e.QP_Content);var s=i.link.split("/");var o=new Date(i.date*1e3);n.auth=e.QP_User;n.url=i.link;n.dt=o.getDate();n.mth=r[o.getMonth()];n.tm=i.time;n.lc=i.location;n.id=e.Article_Event_ID;n.tmsp=e.QP_Timestamp;n.tag=i.tag;n.tl=i.title;n.ctgy=s[2]}else if(t=="posts"){var o=new Date(e.E_Date*1e3);n.auth=e.E_Author;n.url="/Events/"+e.E_Category+"/"+e.E_SubCategory+"/"+e.E_Title_ID;n.dt=o.getDate();n.mth=r[o.getMonth()];n.tm=e.E_Time;n.lc=e.E_Location;n.id="";n.tmsp=e.E_Timestamp;n.tag=e.Tag+" an event";n.tl=e.E_Title;n.ctgy=e.E_Category}else{n.auth=e.R_ReactedBy;n.url=e.R_Link;n.dt="4";n.mth="Apr";n.id=e.R_ID;n.tag="in reply to <a class='u-tag' href='"+e.R_Link+"'>your event</a>";n.tl=e.R_Content;n.ctgy=e.R_Link.split("/")[2];n.tmsp=e.R_Timestamp}switch(n.ctgy){case"Politics":var u="orange";break;case"Technology":u="yellow";break;case"Sports":u="blue";break;case"Entertainment":u="red";break;default:u="green";break}var a="<li class='list'><div class='happening event' data="+n.url+">"+"<span class='tmsp italicText' tmsp='"+n.tmsp+"'></span>"+"<p>"+"<span class='thumb-holder cal italicText "+u+"'><span class='number'>"+n.dt+"</span>"+n.mth+"</span>"+"<span class='pull-right content span3'>"+"<a href='/"+n.auth+"' class='user-small'>"+n.auth+"</a><br>"+"<span class='italicText'>"+n.tag+"</span>"+"<span class='content'>"+n.tl+"</span>"+"</span>"+"<ul class='unfold'>"+"<li class='unfold-ul'><i class='icon-arrow-down'></i> unfold</li>";if(t!="reactions")a+="<li class='hideElement'><a class='know-more' href='"+n.url+"'><i class='icon-chevron-right'></i>Know more</a></li>";a+="</ul>"+"</p>"+"<div class='clearfix'></div></div>"+"<div class='response'><div class='response-holder'>"+"<div class='response-content'  eventid='"+n.id+"'>";if(t!="reactions"){a+="<p><span class='thumb-holder span1'>"+"<span class='num'>0</span> going</span><span class='pull-right content span3'>"+"<span class='location'>"+n.lc+"</span>"+"<span class='date'>"+n.mth+" "+n.dt+", "+n.tm+"</span>"+"</span></p>"}if(t=="stream"){switch(n.tag){case"Created an event":case"commented on event":case"is going to":a+="<button type='button' class='btn btn-success yes join'>Join</button>";break;case"invited you to":a+="<button type='button' class='btn btn-success yes accept'>Accept</button><button type='button' class='btn no decline'>Decline</button>";break}}a+="<div class='clearfix'></div>"+"</div></div></div></li>";return a}function n(e,t){var n={auth:"",img:"",id:"",url:"",tag:"",tl:"",rxn:"",rtg:"",tmsp:""};if(t=="stream"){var r=$.parseJSON(e.QP_Content);n.img=e.QP_Featured_Image;n.auth=e.QP_User;n.tag=r.tag;n.tl=r.title;n.rxn=e.P_Reactions;n.rtg=e.P_Rating;n.url=r.link;n.id=e.Article_Event_ID;n.tmsp=e.QP_Timestamp}else if(t=="posts"){n.img=e.P_Feature_Image;n.auth=e.P_Author;n.tag=e.Tag;n.tl=e.P_Title;n.rxn=e.P_Num_Comments;n.rtg=e.P_Rating;n.url="/"+e.P_Category+"/"+e.P_SubCategory+"/"+e.P_Title_ID;n.id=e.P_ID;n.tmsp=e.P_Timestamp}else{n.img=e.R_Featured_Image;n.auth=e.R_ReactedBy;n.tag="in reply to <a href='"+e.R_Link+"' class='u-tag'> your article</a>";n.tl=e.R_Content;n.rxn=0;n.tmsp=e.R_Timestamp}var i='{"ar_ev_id":"'+n.id+'"}';var s="<li class='list'><div class='happening published' data ='"+i+"'>"+"<span class='tmsp italicText' tmsp='"+n.tmsp+"'></span>"+"<p>"+"<span class='thumb-holder span1'><img src='/Multimedia/Thumb_"+n.img+"' /></span>"+"<span class='pull-right content span3'>"+"<a href='/"+n.auth+"' class='user-small'>"+n.auth+"</a><br>"+"<span class='italicText'>"+n.tag+"</span>"+"<span class='content'>"+n.tl+"</span>"+"</span>"+"<ul class='unfold'>"+"<li class='unfold-ul'><i class='icon-arrow-down'></i> unfold</li>"+"<li class='rct-display hideElement'>"+n.rxn+" Reactions</li>";if(t!="reactions"){s+="<li class='rct-display hideElement'>"+n.rtg+" Votes</li>"+"<li class='hideElement'><a href='"+n.url+"' class='know-more'><i class='icon-chevron-right'></i>Read more</a></li>"}else{"<li class='rct-btn hideElement'><a href='#'>React</a>"+"("+n.rxn+")"}s+="</ul>"+"</p>"+"<div class='clearfix'></div></div>"+"<div class='response'><div class='response-holder'>"+"<ul class='res-list'>"+"<li>Coming Soon.. :D</li>"+"</ul>"+"</div></div>"+"</li>";return s}function r(t,n){var r=0;if(t.QP_Rating!=null)r=t.QP_Rating;var i=0;if(t.P_Reactions!=null)i=t.P_Reactions;var s="<li class='list'><div class='happening posted'><span class='tmsp italicText' tmsp='"+t.QP_Timestamp+"'>few sec ago</span>";if(e.user==t.QP_User){s+="<ul class='dropdown pst-stng hideElement'><a class='dropdown-toggle' data-toggle='dropdown' href='#'><i class='icon-cog'></i><b class='caret'></b></a>"+"<ul class='dropdown-menu pull-right'><li><a href='#' class='delete_quickpost' qpid='"+t.QP_ID+"'>Delete</a></li></ul>"+"</ul>"}s+="<ul class='vote-stats pull-left'><li><button class='btn btn-mini qpost_rating' qpostid='"+t.QP_ID+"' qpnum='0'><i class='icon-arrow-up'></i></li>"+"<li class='number'>"+r+"</li><li class='italicText'>Votes</li>"+"</ul>"+"<p>"+"<span class='pull-right content span3'>"+"<a href='/"+t.QP_User+"' class='user-small'>"+t.QP_User+"</a><br>"+"<span class='italicText'>posted</span>"+"<span class='content'>"+t.QP_Content+"</span>"+"</span>"+"<ul class='unfold'>"+"<li class='unfold-ul'><i class='icon-arrow-down'></i> unfold</li>"+"<li class='rct-display'>"+i+" Reactions</li>"+"<li class='rct-btn hideElement'><a href='#'>React</a>("+i+")</li>"+"</ul>"+"</p>"+"<div class='clearfix'></div></div>"+"<div class='response'><div class='response-holder'>"+"<ul class='res-list'>"+"<li>Coming Soon.. :D</li>"+"</ul>"+"</div></div></li>";return s}function i(e){try{JSON.parse(e)}catch(t){return false}return true}function s(s,o){var u="";var a=5;newtab=false;if($("#user-nav .usrname").text()){if(e.prevTab!=o){e.prevTab=o;e.prevPst=0;if(o=="posts")a=5;else a=10;newtab=true}else{a=5;e.prevPst+=a}$.ajax({url:"/default/index/rightpane",async:true,data:{tab:o,cnt:a,prevCnt:e.prevPst},dataType:"json",type:"post",beforeSend:function(){},success:function(e){console.log(o,e);for(var s=0;s<e.length;s++){if(o=="stream"){if(i(e[s].QP_Content)){switch($.parseJSON(e[s].QP_Content).tag){case"published":case"voted up":case"commented on article":case"voted for a poll":case"mentioned you in article comment":u+=n(e[s],o);break;default:u+=t(e[s],o);break}}else u+=r(e[s])}else if(o=="posts"){switch(e[s].Tag){case"Created":u+=t(e[s],o);break;case"Published":u+=n(e[s],o);break;default:u+=r(e[s],o)}}else{switch(e[s].R_Type){case"Event_Comment":u+=t(e[s],o);break;case"Article_Comment":u+=n(e[s],o);break}}}},complete:function(){if(newtab&&e.prevTab!="posts")e.prevPst+=5;if(s.find("ul.right-comments li").length==1){s.find("ul.right-comments").append(u);$(".tab-content").find(".active .happening").animateElements();s.find(".tmsp").each(function(){$(this).updateTime({ts:$(this).attr("tmsp")})});s.jScrollPane({autoReinitialize:true,verticalGutter:5,showArrows:false});s.find(".jspVerticalBar").hide()}else{s.find("ul.right-comments").append(u);s.find(".tmsp").each(function(){$(this).updateTime({ts:$(this).attr("tmsp")})});s.jScrollPane({autoReinitialize:true,verticalGutter:5,showArrows:false})}}});return true}}function o(e){var t='<div class="tile-holder">';for(var n=0;n<=2;n++){if(n==1)t+=l(1,e[n],"admrgn");else t+=l(1,e[n])}t+="<div class='clearfix'></div></div>";return t}function u(e){var t="<div class='tile-holder'>";for(var n=0;n<=1;n++){if(n==0)t+=l(2,e[n]);else t+=l(1,e[n])}t+="<div class='clearfix'></div></div>";return t}function a(e){var t="<div class='tile-holder'>";t+=l(3,e[0]);t+="<div class='clearfix'></div></div>";return t}function f(e){var t="<div class='tile-holder'>";for(var n=0;n<=2;n++){if(n==0)t+=l(4,e[n]);else t+=l(1,e[n])}t+="<div class='clearfix'></div></div>";return t}function l(e,t,n){var r=$.parseJSON(t);if(!n)var n="";else n="ad-mrgn";var i='<div class="tile tile'+e+" "+n+'"><a href="/'+t.P_Category+"/"+t.P_SubCategory+"/"+t.P_Title_ID+'">'+'<img class="tile-image" src="/Multimedia/'+t.P_Feature_Image+'" />'+'<span class="shw-cgry '+t.P_Category+'">';switch(t.P_Category){case"Technology":i+="Tech";break;case"Entertainment":i+="Page 3";break;default:i+=t.P_Category;break}i+="</span>"+'<div class="heading">'+'<div class="title">'+t.P_Title+"</div>"+'<div class="italicText"><i class="icon-circle '+t.P_Category+'-i"></i> '+t.P_Author+'</div></div><div class="he-bg"></div></a>'+'<ul class="article-stats">'+'<li><a href="#"><i class="icon-calendar"></i>'+t.P_Num_Events+" Events</a></li>"+'<li><a href="#"><i class="icon-comment"></i>'+t.P_Num_Comments+" Comments</a></li></ul>"+"</div>";return i}function c(e){e.find(".tile-image").each(function(){$(this).load(function(){$(this).scaleImages({dw:$(this).parents("div").width(),dh:$(this).parents("div").height()})})})}var e={user:$("#user-nav .usrname").text(),nxpg:2,loading:false,prevNws:7,prevCnt:0,prevtp:"All",prevTab:"",prevPst:10,newTab:false};$.fn.loadData=function(e){var t=s($(this),e.tab);return t};$.fn.extend({addNews:function(t){if(!e.loading&&$(this).find(".tile-holder").length){e.loading=true;var n=Math.ceil(Math.random()*4);var r=0;switch(n){case 1:case 4:r=3;break;case 2:r=2;break;case 3:r=1;break}if(e.prevtp!=t.cgry){e.prevtp=t.cgry;e.prevNws=7}else e.prevNws+=e.prevCnt;var i="";if(t.cgry=="Articles")$("#usr-pg").append("<img class='loading' src='/images/loading.gif' />");else $("#news-bar").append("<img class='loading' src='/images/loading.gif' />");$.ajax("/Blog/Post/getposts",{dataType:"json",async:true,type:"post",data:{page:e.nxpg,category:t.cgry,cnt:r,pc:e.prevNws,usr:t.usr},beforeSend:function(){if(t.cgry=="Articles")$("#usr-pg").find("img.loading").positionElement({parent:$("#usr-pg"),top:false});else $("#news-bar").find("img.loading").positionElement({parent:$("#news-bar"),top:false})},success:function(e){if(e.length>0){switch(e.length){case 1:i=a(e);break;case 2:i=u(e);break;case 3:var t=Math.ceil(Math.random()*2);if(t==1)i=o(e);else i=f(e);break}}},complete:function(){if(t.cgry=="Articles"){$("#usr-pg").find("img.loading").remove();$("#usr-pg").append('<div id="page'+e.nxpg+'">'+i+"</div>");c($("#usr-pg"))}else{$("#news-bar").find("img.loading").remove();$("#news-bar").append('<div id="page'+e.nxpg+'">'+i+"</div>");c($("#news-bar"))}c($("#page"+e.nxpg));e.nxpg++;e.prevCnt=r;e.loading=false}})}},loadNews:function(e){var t="";var n=e.usr;var t="";if(e.cgry=="Articles")$("#usr-pg").append("<img class='loading' src='/images/loading.gif' />");else $("#news-bar").append("<img class='loading' src='/images/loading.gif' />");$.ajax("/Blog/Post/getposts",{data:{page:1,category:e.cgry,cnt:7,pc:0,usr:n},dataType:"json",async:true,type:"post",beforeSend:function(){if(e.cgry=="Articles")$("#usr-pg").find("img.loading").positionElement({parent:$("#usr-pg"),top:false});else $("#news-bar").find("img.loading").positionElement({parent:$("#news-bar"),top:false})},success:function(e){switch(e.length){case 1:t=a(e[0]);break;case 2:t=u(e);break;case 3:t=o(e);break;case 4:t=o(e.slice(0,3));t+=a(e.slice(3));break;case 5:t=o(e.slice(0,3));t+=u(e.slice(3));break;case 6:t=o(e.slice(0,3));t+=a(e.slice(3,4));t+=u(e.slice(4));break;case 7:t=o(e.slice(0,3));t+=a(e.slice(3,4));t+=f(e.slice(4));break}},complete:function(){if(e.cgry=="Articles"){$("#usr-pg").find("img.loading").remove();$("#usr-pg").append(t);c($("#usr-pg"))}else{$("#news-bar").find("img.loading").remove();$("#news-bar").append(t);c($("#news-bar"))}}})},updateTime:function(e){var t=new Date(e.ts*1e3);var n=new Date;var r=Math.floor((n.getTime()-t.getTime())/1e3);var i=new Array;i[0]="Jan";i[1]="Feb";i[2]="Mar";i[3]="Apr";i[4]="May";i[5]="Jun";i[6]="Jul";i[7]="Aug";i[8]="Sep";i[9]="Oct";i[10]="Nov";i[11]="Dec";if(r<60)$(this).text(r+"sec ago");else if(r>=60&&r<3600){var s=Math.floor(r/60);if(s==1)$(this).text("A min ago");else $(this).text(s+"min ago")}else if(r>=3600&&r<86400){var s=Math.floor(r/(60*60));if(s==1)$(this).text("An hr ago");else $(this).text(s+"hrs ago")}else if(r>=86400&&r<2592e3){var s=Math.floor(r/(60*60*24));if(s==1)$(this).text("A day ago");else $(this).text(s+"days ago")}else{$(this).text(i[t.getMonth()]+" "+t.getDate()+", "+t.getFullYear())}}})})